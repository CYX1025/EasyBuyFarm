<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>EastBuyFarmå¥½è¾²æ˜“ - ç™»å…¥</title>
  <link rel="stylesheet" href="style.css">
  <script src="script.js" defer></script>
</head>
<body>
  <!-- Navbar -->
  <header class="navbar">
    <div class="navbar-left">
      <div class="logo">
        <a href="index.html"><img src="images/logo_02.png" alt="MyShop"></a>
      </div>
      <input type="text" class="search-box" placeholder="æœå°‹å•†å“ã€å“ç‰Œ...">
    </div>
    <a href="storelist.html" class="btn">è³£å ´åˆ—è¡¨</a>
    <div class="navbar-right">
      <div class="dropdown">
        <button class="dropbtn">æœƒå“¡é¸å–® â–¼</button>
        <div class="dropdown-content">
          <a href="login.html" id="login-link">ç™»å…¥</a>
          <a href="register.html" id="register-link">è¨»å†Š</a>
          <a href="member.html" id="member-btn" style="display:none;">æœƒå“¡ä¸­å¿ƒ</a>
          <a href="index.html" onclick="logoutUser()" id="logout-link" style="display:none;">ç™»å‡º</a>
        </div>
      </div>
      <a href="cart.html" class="cart">ğŸ›’ è³¼ç‰©è»Š <span id="cart-count">0</span></a>
      <button id="be-seller-btn">æˆç‚ºè³£å®¶</button>
    </div>
  </header>

  <!-- ç™»å…¥è¡¨å–® -->
  <main class="login-container">
    <h2>æœƒå“¡ç™»å…¥</h2>
    <form id="login-form">
      <label for="username">é›»è©± / Email</label>
      <input type="text" id="username" required>

      <label for="password">å¯†ç¢¼</label>
      <input type="password" id="password" required>

      <button type="submit" class="btn">ç™»å…¥</button>

      <div class="login-links">
        <a href="register.html">è¨»å†Šæ–°æœƒå“¡</a> | 
        <a href="forgot-password.html">å¿˜è¨˜å¯†ç¢¼ï¼Ÿ</a>
      </div>
    </form>
  </main>

  <footer class="footer">
    <div class="footer-content">
      <p>Â© 2025 EastBuyFarm. All Rights Reserved.</p>
      <nav class="footer-links">
        <a href="#">é—œæ–¼æˆ‘å€‘</a> |
        <a href="#">éš±ç§æ”¿ç­–</a> |
        <a href="#">å®¢æœä¸­å¿ƒ</a> |
        <a href="#">è¯çµ¡æˆ‘å€‘</a>
      </nav>
    </div>
  </footer>

  <script>
  // ç™»å…¥é€å‡º
  document.getElementById("login-form").addEventListener("submit", async (e) => {
    e.preventDefault();

    const keyword = document.getElementById("username").value;
    const password = document.getElementById("password").value;

    try {
      const res = await fetch("http://localhost:8080/easybuyfarm/api/members/login", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: `keyword=${encodeURIComponent(keyword)}&password=${encodeURIComponent(password)}`
      });

      if (res.ok) {
        const member = await res.json();
        localStorage.setItem("loggedInUser", JSON.stringify(member));
        alert(`ç™»å…¥æˆåŠŸï¼Œæ­¡è¿ ${member.email || member.phone}`);
        updateNavbar();
        window.location.href = "index.html"; // å¯æ”¹æˆæœƒå“¡ä¸­å¿ƒé 
      } else {
        const msg = await res.text();
        alert(msg);
      }
    } catch (err) {
      console.error(err);
      alert("ä¼ºæœå™¨éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦");
    }
  });
  </script>
</body>
</html>
