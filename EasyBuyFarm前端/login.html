<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>EastBuyFarm好農易 - 登入</title>
  <link rel="stylesheet" href="style.css">
  <script src="script.js" defer></script>
</head>
<body>
  <!-- Navbar -->
  <header class="navbar">
    <div class="navbar-left">
      <div class="logo">
        <a href="index.html"><img src="images/logo_02.png" alt="MyShop"></a>
      </div>
      <input type="text" class="search-box" placeholder="搜尋商品、品牌...">
    </div>
    <a href="storelist.html" class="btn">賣場列表</a>
    <div class="navbar-right">
      <div class="dropdown">
        <button class="dropbtn">會員選單 ▼</button>
        <div class="dropdown-content">
          <a href="login.html" id="login-link">登入</a>
          <a href="register.html" id="register-link">註冊</a>
          <a href="member.html" id="member-btn" style="display:none;">會員中心</a>
          <a href="index.html" onclick="logoutUser()" id="logout-link" style="display:none;">登出</a>
        </div>
      </div>
      <a href="cart.html" class="cart">🛒 購物車 <span id="cart-count">0</span></a>
      <button id="be-seller-btn">成為賣家</button>
    </div>
  </header>

  <!-- 登入表單 -->
  <main class="login-container">
    <h2>會員登入</h2>
    <form id="login-form">
      <label for="username">電話 / Email</label>
      <input type="text" id="username" required>

      <label for="password">密碼</label>
      <input type="password" id="password" required>

      <button type="submit" class="btn">登入</button>

      <div class="login-links">
        <a href="register.html">註冊新會員</a> | 
        <a href="forgot-password.html">忘記密碼？</a>
      </div>
    </form>
  </main>

  <footer class="footer">
    <div class="footer-content">
      <p>© 2025 EastBuyFarm. All Rights Reserved.</p>
      <nav class="footer-links">
        <a href="#">關於我們</a> |
        <a href="#">隱私政策</a> |
        <a href="#">客服中心</a> |
        <a href="#">聯絡我們</a>
      </nav>
    </div>
  </footer>

  <script>
  // 登入送出
  document.getElementById("login-form").addEventListener("submit", async (e) => {
    e.preventDefault();

    const keyword = document.getElementById("username").value;
    const password = document.getElementById("password").value;

    try {
      const res = await fetch("http://localhost:8080/easybuyfarm/api/members/login", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: `keyword=${encodeURIComponent(keyword)}&password=${encodeURIComponent(password)}`
      });

      if (res.ok) {
        const member = await res.json();
        localStorage.setItem("loggedInUser", JSON.stringify(member));
        alert(`登入成功，歡迎 ${member.email || member.phone}`);
        updateNavbar();
        window.location.href = "index.html"; // 可改成會員中心頁
      } else {
        const msg = await res.text();
        alert(msg);
      }
    } catch (err) {
      console.error(err);
      alert("伺服器錯誤，請稍後再試");
    }
  });
  </script>
</body>
</html>
